#!/usr/bin/env node

var program = require('commander')

var User = require('../lib/data/user')

program
  .command('ls')
  .description('list all existed users')
  .action(function () {
    User.list(function (err, users) {
      if (err) {
        return console.error(err.stack)
      }

      if (users.length) {
        console.log(users.join('\n'))
      }
    })
  })

program
  .command('add <user>')
  .description('add an user')
  .action(function (name) {
    program.password('Enter password: ', function (password) {
      User.add(name, password, function (err) {
        if (err) {
          if ('EEXIST' == err.code) {
            console.log('')
            console.log('  error: user \'%s\' already exists', name)
            console.log('')
            return
          }

          return console.error(err.stack)
        }
      })
    })
  })

program
  .command('rm [user]')
  .description('remove an/all user')
  .action(function (name) {
    User.remove(name, function (err) {
      if (err) {
        if ('ENOENT' == err.code) {
          console.log('')
          console.log('  error: user \'%s\' not exists', name)
          console.log('')
          return
        }

        return console.error(err.stack)
      }
    })
  })

program
  .command('update <user>')
  .description('update password of <user>')
  .action(function (name) {
    User.findToUpdate(name, function (err, user, update) {

    })
  })

program
  .command('logs')
  .description('show logs of current user')
  .action()

program.parse(process.argv)

if (!program.args.length) {
  User.list(function (err, users) {
    console.log(users.join('\n'))
  })
}
